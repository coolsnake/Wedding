{% extends 'index_layout.html' %}

{% block title %}商品列表{% end %}

{% block js %}
<script>
    function find_condition_and_change_value(find_url_str, new_value) {
        var target_url = ""
        if (window.location.href.indexOf(find_url_str)>0){
            wait_replace_str = find_url_str+'='+escape(getQueryString(find_url_str))
            target_url = window.location.href.replace(wait_replace_str, find_url_str+'='+escape(new_value))
        }else {
            target_url = window.location.href + '&'+find_url_str+'=' + escape(new_value)
        }
        return target_url
    }
    
    function filter_product_price() {
        filter_price = $('#filter_price').val()
        target_url = find_condition_and_change_value('filter_price', filter_price)
        window.location = target_url
    }

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    $(function(){
        {#回显筛选的商品价格#}
        $('#filter_price')[0]['dataset']['value']=1

        {#回显排序方式#}
        if (getQueryString('order')){
            $('#filter_order').val(getQueryString('order'))
        }

        {#显示已选筛选条件#}
        var current_filter_list_html = "<a style='color:red' href='/index?pid={{ page_info['pid'] }}'>清空当前筛选条件</a>&nbsp;"
        var is_show = false
        if (getQueryString('filter_price')){
            current_filter_list_html =current_filter_list_html+" | 价格<"+getQueryString('filter_price')
            is_show = true
        }
        if (getQueryString('brand')){
            current_filter_list_html =current_filter_list_html+" | 品牌:"+ unescape(getQueryString('brand'))
            is_show = true
        }
        if (getQueryString('page')){
            current_filter_list_html =current_filter_list_html+" | 当前页数:"+ unescape(getQueryString('page'))
            is_show = true
        }
        if (getQueryString('label')){
            current_filter_list_html =current_filter_list_html+" | 标签:"+ unescape(getQueryString('label'))
            is_show = true
        }
        if(is_show){
            $('#current_filter_list').html(current_filter_list_html)
        }
    });
    
    function click_brand(brand) {
        target_url = find_condition_and_change_value('brand', brand)
        window.location = target_url
    }

    function change_page(page_num) {
        target_url = find_condition_and_change_value('page', page_num)
        window.location = target_url
    }
    
    function product_filter_order() {
        order_id = ($('#filter_order').val())
        target_url = find_condition_and_change_value('order', order_id)
        window.location = target_url
    }
    
    function filter_label(label) {
        target_url = find_condition_and_change_value('label', label)
        window.location = target_url
    }
    
</script>
{% end %}

{% block content %}
<section class="sub-header shop-layout-1">
<img class="rellax bg-overlay" src="https://desk-fd.zol-img.com.cn/t_s1366x768c5/g5/M00/00/05/ChMkJlmetZyIIkmuAAjuHSYCKnsAAf8XgJEPXQACO41066.jpg" alt="">
<div class="overlay-call-to-action"></div>
<h3 class="heading-style-3">{{ name }}</h3>
</section>
<section class="boxed-sm">
<div class="container">
  <div class="row">
    <div class="row main">
      <div class="col-md-3">
        <div class="sidebar" >
          <div class="widget widget-filter-price" style="float: right;margin-top: 20px;">
            <h4 class="title-widget text-center">价格筛选</h4>
            <input class="js-filter-price" id="filter_price" type="text" data-slider-min="1" data-slider-max="{{ max_price }}" data-slider-step="1" data-slider-value="{{ max_price }}">
            <div class="filter-price-control-box">
              <a class="btn btn-brand btn-filter" onclick="filter_product_price()" style="cursor: pointer">确认</a>
              <p>价格区间:
                <span>￥</span>
                <span>1 - </span>
                <span id="js-filter-result-val">{{ max_price }}</span>
                <span>￥</span>
              </p>
            </div>
          </div>
          <div class="widget widget-categories">
            <h4 class="title-widget text-center">品牌分类</h4>
            <ul>
                {% for brand in product_brand_list %}
              <li>
                <a style="cursor: pointer" onclick="click_brand('{{ brand['ProductBrand'] }}')" >{{ brand['ProductBrand'] }}
                </a>
              </li>
                {% end %}

            </ul>
          </div>
          <div class="widget widget-product-bestseller">
            <h4 class="title-widget text-center">推荐商品</h4>
            <ul class="list-product">
                {% for hot_product in hot_product_list %}
              <li>
                <a href="shop-detail.html">
                  <div class="img-wrapper">
                    <img src="{{ static_url('images/upload/') }}{{ hot_product['ProductSmallPicture'] }}" alt="product">
                  </div>
                  <div class="desc">
                    <h5 class="title">{{ hot_product['ProductName'] }}</h5>
                    <p class="price">{{ hot_product['ProductMarketPrice'] }}</p>
                  </div>
                </a>
              </li>
                {% end %}
            </ul>
          </div>
          <div class="widget widget-tags">
            <h4 class="title text-center">标签分类</h4>
            <ul>
                {% for key in key_words_list %}
              <li>
                <a style="cursor:pointer;" onclick="filter_label('{{ key }}')">{{ key }}</a>
              </li>
                {% end %}
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-9">
        <div class="woocommerce-top-control wrapper">
          <div class="woocommerce-top-control">
              {% if page_info['page_data_count']==0 %}
                  <p class="woocommerce-result-count">无符合条件的数据</p>
              {% else %}
                  <p class="woocommerce-result-count">分类共 {{ page_info['data_count'] }} 条数据 本页显示{{ page_info['page_data_count'] }}条数据</p>
              {% end %}
              <p id="current_filter_list"></p>
            <form class="woocommerce-ordering select-custom-wrapper" method="get">
              <select onchange="product_filter_order()" id="filter_order" class="orderby select-custom-wrapper" name="orderby">
                <option value="1" selected="selected">默认排序</option>
                <option value="2">价格从高到低</option>
                <option value="3">销量从高到低</option>
                <option value="4">评论从高到低</option>
                <option value="5">上架时间从高到低</option>
                <option value="6">销量从高到低</option>
              </select>
            </form>
          </div>
        </div>
        <div class="row product-grid-equal-height-wrapper product-equal-height-3-columns flex multi-row">
          {% for product in product_list %}
            <figure class="item">
            <div class="product product-style-1">
              <div class="img-wrapper">
                <a href="shop-detail.html">
                  <img class="img-responsive" src="{{ static_url('picture/01.jpg') }}" alt="product thumbnail" />
                </a>
                <div class="product-control-wrapper bottom-right">
                  <div class="wrapper-control-item">
                    <a class="js-quick-view" href="#" type="button" data-toggle="modal" data-target="#quick-view-product-{{ product['ProductID'] }}">
                      <span class="lnr lnr-eye"></span>
                    </a>
                  </div>
                  <div class="wrapper-control-item item-wish-list">
                    <a class="js-wish-list js-notify-add-wish-list" href="#">
                      <span class="lnr lnr-heart"></span>
                    </a>
                  </div>
                  <div class="wrapper-control-item item-add-cart js-action-add-cart">
                    <a class="animate-icon-cart" href="#">
                      <span class="lnr lnr-cart"></span>
                    </a>
                    <svg x="0px" y="0px" width="36px" height="32px" viewbox="0 0 36 32">
                      <path stroke-dasharray="19.79 19.79" fill="none" ,="," stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" d="M9,17l3.9,3.9c0.1,0.1,0.2,0.1,0.3,0L23,11"></path>
                    </svg>
                  </div>
                </div>
              </div>
              <figcaption class="desc text-center">
                <h3>
                  <a class="product-name" href="shop-detail.html">{{ product['ProductName'] }}</a>
                </h3>
                <span class="price">市场价:{{ product['ProductMarketPrice'] }} {% if product['IsNew'] ==1 %}| 新品 {% end %} {% if product['IsHot'] ==1 %}| 热门 {% end %}</span>
              </figcaption>
            </div>
          </figure>








            {% end %}
        </div>
        <div class="row" style="margin-bottom: 50px;">
          <div class="col-md-12 text-center">
            <nav>
              <ul class="pagination pagination-style-2">
                <li>
                  <a class="prev page-numbers" href="#">
                    <i class="fa fa-long-arrow-left"></i>
                  </a>
                </li>
                  {% for page in xrange(page_info['max_page']) %}
{#                <li>#}
{#                   <span class="page-numbers current">1</span>#}
{#                </li>#}
                  {% if page_info['page_num']==page+1 %}
                    <li>
                        <span class="page-numbers current">{{ page+1 }}</span>
                    </li>
                  {% else %}
                    <li>
                        <a class="page-numbers" style="cursor:pointer;" onclick="change_page('{{ page+1 }}')">{{ page+1 }}</a>
                    </li>
                  {% end %}
                  {% end %}

                <li>
                  <a class="next page-numbers" href="#">
                    <i class="fa fa-long-arrow-right"></i>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</section>

{% for product in product_list %}

    <div class="modal fade" id="quick-view-product-{{ product['ProductID'] }}" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg modal-quickview woocommerce" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <div class="woocommerce-product-gallery">
                  <div class="main-carousel-product-quick-view">
                    <div class="item">
                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ product['ProductSmallPicture'] }}" alt="" />
                    </div>
                    <div class="item">
                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ product['ProductBigPictureProductBigPicture'] }}" alt="" />
                    </div>
                  </div>
                  <div class="thumbnail-carousel-product-quickview">
                    <div class="item">
                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ product['ProductSmallPicture'] }}" alt="" />
                    </div>
                    <div class="item">
                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ product['ProductBigPictureProductBigPicture'] }}" alt="" />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="summary">
                  <div class="desc">
                    <div class="header-desc">
                      <h2 class="product-title">{{ product['ProductName'] }}</h2>
                      <p class="price">{{ product['ProductMarketPrice'] }}</p>
                    </div>
                    <div class="body-desc">
                      <div class="woocommerce-product-details-short-description">
                        <p>{{ product['ProductIntroduce'] }} </p>
                      </div>
                    </div>
                    <div class="footer-desc">
                      <form class="cart">
                        <div class="quantity buttons-added">
                          <input class="minus" value="-" type="button" />
                          <input class="input-text qty text" step="1" min="1" max="100" name="quantity" value="1" title="Qty" size="4" pattern="[0-9]*" inputmode="numeric" type="number" />
                          <input class="plus" value="+" type="button" />
                        </div>
                        <div class="group-btn-control-wrapper">
                            <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
                          <button onclick="AddShopCart('{{ product['ProductID'] }}')" class="btn btn-brand no-radius">添加到购物车</button>
                          <button onclick="CollectionProduct('{{ product['ProductID'] }}')" class="btn btn-wishlist btn-brand-ghost no-radius">
                            <i class="fa fa-heart"></i>
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="product-meta">
                    <p class="posted-in">品牌:
                      <a href="#" rel="tag">{{ product['ProductBrand'] }}</a>
                    </p>
                    <p class="tagged-as">关键字:
                      <a href="#" rel="tag">{{ product['ProductKeywords'] }}</a>
                    </p>
                    <p class="id">ID:
                      <a href="#">{{ product['ProductID'] }}</a>
                    </p>
                    <div class="bshare-custom"><a title="分享到QQ空间" class="bshare-qzone"></a><a title="分享到新浪微博" class="bshare-sinaminiblog"></a><a title="分享到人人网" class="bshare-renren"></a><a title="分享到腾讯微博" class="bshare-qqmb"></a><a title="分享到网易微博" class="bshare-neteasemb"></a><a title="更多平台" class="bshare-more bshare-more-icon more-style-addthis"></a><span class="BSHARE_COUNT bshare-share-count">0</span></div><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=&amp;pophcol=1&amp;lang=zh"></script><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
                  </div>
                  <div class="widget-social align-left">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
{% end %}

{% end %}




{#{% for product in product_list %}#}
{##}
{#<div class="modal fade" id="quick-view-product-22" tabindex="-1" role="dialog">#}
{#      <div class="modal-dialog modal-lg modal-quickview woocommerce" role="document">#}
{#        <div class="modal-content">#}
{#          <div class="modal-header">#}
{#            <button class="close" type="button" data-dismiss="modal" aria-label="Close">#}
{#              <span aria-hidden="true">×</span>#}
{#            </button>#}
{#          </div>#}
{#          <div class="modal-body">#}
{#            <div class="row">#}
{#              <div class="col-md-6">#}
{#                <div class="woocommerce-product-gallery">#}
{#                  <div class="main-carousel-product-quick-view">#}
{#                    <div class="item">#}
{#                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ info_2_2.ProductSmallPicture }}" alt="" />#}
{#                    </div>#}
{#                    <div class="item">#}
{#                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ info_2_2.ProductBigPictureProductBigPicture }}" alt="" />#}
{#                    </div>#}
{#                  </div>#}
{#                  <div class="thumbnail-carousel-product-quickview">#}
{#                    <div class="item">#}
{#                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ info_2_2.ProductSmallPicture }}" alt="" />#}
{#                    </div>#}
{#                    <div class="item">#}
{#                      <img class="img-responsive" src="{{ static_url('images/upload/') }}{{ info_2_2.ProductBigPictureProductBigPicture }}" alt="" />#}
{#                    </div>#}
{#                  </div>#}
{#                </div>#}
{#              </div>#}
{#              <div class="col-md-6">#}
{#                <div class="summary">#}
{#                  <div class="desc">#}
{#                    <div class="header-desc">#}
{#                      <h2 class="product-title">{{ info_2_2.ProductName }}</h2>#}
{#                      <p class="price">{{ info_2_2.ProductMarketPrice }}</p>#}
{#                    </div>#}
{#                    <div class="body-desc">#}
{#                      <div class="woocommerce-product-details-short-description">#}
{#                        <p>{{ info_2_2.ProductIntroduce }} </p>#}
{#                      </div>#}
{#                    </div>#}
{#                    <div class="footer-desc">#}
{#                      <form class="cart">#}
{#                        <div class="quantity buttons-added">#}
{#                          <input class="minus" value="-" type="button" />#}
{#                          <input class="input-text qty text" step="1" min="1" max="100" name="quantity" value="1" title="Qty" size="4" pattern="[0-9]*" inputmode="numeric" type="number" />#}
{#                          <input class="plus" value="+" type="button" />#}
{#                        </div>#}
{#                        <div class="group-btn-control-wrapper">#}
{#                            <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>#}
{#                          <button onclick="AddShopCart('{{ info_2_2.ProductID }}')" class="btn btn-brand no-radius">添加到购物车</button>#}
{#                          <button onclick="CollectionProduct('{{ info_2_2.ProductID }}')" class="btn btn-wishlist btn-brand-ghost no-radius">#}
{#                            <i class="fa fa-heart"></i>#}
{#                          </button>#}
{#                        </div>#}
{#                      </form>#}
{#                    </div>#}
{#                  </div>#}
{#                  <div class="product-meta">#}
{#                    <p class="posted-in">品牌:#}
{#                      <a href="#" rel="tag">{{ info_2_2.ProductBrand }}</a>#}
{#                    </p>#}
{#                    <p class="tagged-as">关键字:#}
{#                      <a href="#" rel="tag">{{ info_2_2.ProductKeywords }}</a>#}
{#                    </p>#}
{#                    <p class="id">ID:#}
{#                      <a href="#">{{ info_2_2.ProductID }}</a>#}
{#                    </p>#}
{##}
{#                      <!-- JiaThis Button BEGIN -->#}
{#                        <div class="jiathis_style">#}
{#                            <a class="jiathis_button_qzone"></a>#}
{#                            <a class="jiathis_button_tsina"></a>#}
{#                            <a class="jiathis_button_tqq"></a>#}
{#                            <a class="jiathis_button_weixin"></a>#}
{#                            <a class="jiathis_button_renren"></a>#}
{#                            <a class="jiathis_button_xiaoyou"></a>#}
{#                            <a class="jiathis_button_ydnote"></a>#}
{#                            <a class="jiathis_button_miliao"></a>#}
{#                            <a class="jiathis_button_cqq"></a>#}
{##}
{#                            <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>#}
{#                            <a class="jiathis_counter_style"></a>#}
{#                        </div>#}
{#                        <script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js" charset="utf-8"></script>#}
{#                  </div>#}
{#                  <div class="widget-social align-left">#}
{#                  </div>#}
{#                </div>#}
{#              </div>#}
{#            </div>#}
{#          </div>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
{#{% end %}#}